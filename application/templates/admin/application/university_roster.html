{% extends "admin/base_site.html" %}
{% load i18n %}

{% block breadcrumbs %}
    <div class="breadcrumbs">
        <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
        &rsaquo; <a href="{% url 'admin:app_list' 'application' %}">{% trans 'Applications' %}</a>
        &rsaquo; <a href="{% url 'admin:application_application_changelist' %}">{% trans 'Applications' %}</a>
        &rsaquo; {{ title }}
    </div>
{% endblock %}

{% block content_title %}{{ title }}{% endblock %}

{% block content %}
    <div class="module">
        <h2>{% trans "Filter participants by school" %}</h2>
        <p class="help">{% trans "Select an edition, type, and enter the school name to list matching participants." %}</p>
        <form method="get" novalidate>
            {{ form.non_field_errors }}
            <fieldset class="module aligned">
                {% for field in form %}
                    <div class="form-row">
                        <label for="{{ field.id_for_label }}">
                            {{ field.label }}{% if field.field.required %}<span class="required">*</span>{% endif %}
                        </label>
                        <div class="field-box">
                            {{ field }}
                            {% if field.help_text %}<p class="help">{{ field.help_text }}</p>{% endif %}
                            {{ field.errors }}
                        </div>
                    </div>
                {% endfor %}
            </fieldset>
            <div class="submit-row">
                <button type="submit" class="button default">{% trans "Apply filters" %}</button>
                {% if filters_applied %}
                    <button type="submit" name="download" value="1" class="button">{% trans "Download CSV" %}</button>
                {% endif %}
            </div>
        </form>
    </div>

    {% if filters_applied %}
        {% if total %}
            <div class="module">
                <h2>{% trans "Results" %}</h2>
                <p class="help">
                    {% blocktrans with total=total school=school_query %}Found {{ total }} participant(s) matching "{{ school }}".{% endblocktrans %}
                </p>
                {% if status_breakdown %}
                    <h3>{% trans "Status breakdown" %}</h3>
                    <ul>
                        {% for status, count in status_breakdown %}
                            <li><strong>{{ status }}</strong>: {{ count }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                <table style="width:100%; border-collapse:collapse; margin-top:12px;">
                    <thead>
                        <tr>
                            <th style="text-align:left; padding:8px; border-bottom:1px solid #333;">{% trans "Full name" %}</th>
                            <th style="text-align:left; padding:8px; border-bottom:1px solid #333;">{% trans "Email" %}</th>
                            <th style="text-align:left; padding:8px; border-bottom:1px solid #333;">{% trans "Status" %}</th>
                            <th style="text-align:left; padding:8px; border-bottom:1px solid #333;">{% trans "School" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in roster %}
                            <tr>
                                <td style="padding:8px; border-bottom:1px solid #222;">{{ entry.name }}</td>
                                <td style="padding:8px; border-bottom:1px solid #222;">
                                    {% if entry.email %}
                                        <a href="mailto:{{ entry.email }}">{{ entry.email }}</a>
                                    {% else %}
                                        <span class="help">{% trans "No email on file" %}</span>
                                    {% endif %}
                                </td>
                                <td style="padding:8px; border-bottom:1px solid #222;">{{ entry.status }}</td>
                                <td style="padding:8px; border-bottom:1px solid #222;">{{ entry.school }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="module">
                <h2>{% trans "Results" %}</h2>
                <p class="help">
                    {% blocktrans with school=school_query %}No participants were found for "{{ school }}".{% endblocktrans %}
                </p>
            </div>
        {% endif %}
    {% endif %}

    <p><a href="{% url 'admin:application_application_changelist' %}">&larr; {% trans "Back to applications" %}</a></p>
{% endblock %}
